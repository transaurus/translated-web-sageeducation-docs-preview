---
sidebar_position: 11
title: "🔎 Retrieval Augmented Generation (RAG)"
---

Retrieval Augmented Generation（RAG）は、多様なソースからのコンテキストを組み込むことでチャットボットの会話能力を強化する最先端技術です。ローカルおよびリモートのドキュメント、ウェブコンテンツ、YouTube動画などのマルチメディアソースから関連情報を取得し、取得したテキストを事前定義されたRAGテンプレートと組み合わせてユーザーのプロンプトに付加することで、より情報豊かで文脈に即した応答を可能にします。

RAGの主な利点は、様々なソースから情報にアクセスして統合できることであり、複雑な会話シナリオに最適なソリューションです。例えば、ユーザーが特定のドキュメントやウェブページに関連する質問をした場合、RAGはそのソースから関連情報を取得してチャット応答に組み込むことができます。また、YouTube動画などのマルチメディアソースからも情報を取得可能で、動画の字幕やトランスクリプトを分析して関連情報を抽出し、チャット応答に活用します。

## ローカルおよびリモートRAG連携

ローカルドキュメントを利用するには、まずワークスペースエリアの「Documents」セクションからアップロードする必要があります。クエリの前に`#`記号を使用してアクセス可能です。チャットボックスの上に表示されるフォーマット済みURLをクリックしてください。選択が成功すると、「Send a message」の上にドキュメントアイコンが表示されます。

`#`で始まるプロンプトの後にURLを続けることで、ワークスペースエリアにドキュメントを直接読み込むこともできます。これによりウェブコンテンツを会話に直接組み込むことが可能です。

## RAG向けウェブ検索

ウェブコンテンツを統合するには、チャットで`#`で始まるクエリの後にターゲットURLを入力します。チャットボックスの上に表示されるボックス内のフォーマット済みURLをクリックしてください。選択が成功すると、「Send a message」の上にドキュメントアイコンが表示されます。Sage WebUIは可能な限りURLから情報を取得して解析します。

:::tip
ウェブページにはナビゲーションやフッターなどの余分な情報が含まれることが多いです。より良い結果を得るには、生のコンテンツまたはリーダーフレンドリーなバージョンのページにリンクしてください。
:::

## RAGテンプレートのカスタマイズ

RAGテンプレートは「Admin Panel」＞「Settings」＞「Documents」メニューからカスタマイズできます。

## RAGエンベディングのサポート

RAGエンベディングモデルは「Admin Panel」＞「Settings」＞「Documents」メニューから直接変更可能です。この機能はOllamaとOpenAIモデルをサポートしており、要件に応じたドキュメント処理の強化が可能です。

## RAG機能の引用機能

RAG機能では、LLMに渡されたドキュメントのコンテキストを簡単に追跡できる引用機能が利用可能です。これによりチャット内での外部ソース利用の透明性と説明責任が確保されます。

## 強化されたRAGパイプライン

RAGエンベディング機能の切り替え可能なハイブリッド検索サブ機能は、`BM25`による検索と`CrossEncoder`による再ランキング、設定可能な関連性スコア閾値により、RAG機能を強化します。これにより特定のユースケースに合わせたより精密なRAG体験が可能になります。

## YouTube向けRAGパイプライン

動画URL経由でYouTube動画を要約する専用RAGパイプラインにより、動画トランスクリプションとのスムーズな連携が可能です。この革新的な機能により、動画コンテンツをチャットに組み込むことができ、会話体験をさらに豊かにします。

## ドキュメント解析

ローカルおよびリモートドキュメントからコンテンツを抽出する様々なパーサーが利用可能です。詳細は[`get_loader`](https://github.com/Startr/AI-WEB-openwebui/blob/2fa94956f4e500bf5c42263124c758d8613ee05e/backend/apps/rag/main.py#L328)関数を参照してください。

## Google Drive連携

Google Picker APIとGoogle Drive APIが有効化されたGoogle Cloudプロジェクトと連携することで、この機能によりユーザーはチャットインターフェースから直接Driveファイルにアクセスし、ドキュメント、スライド、スプレッドシートなどをアップロードしてチャットのコンテキストとして利用できます。`管理パネル` > `設定` > `ドキュメント`メニューから有効化可能です。使用するには[`GOOGLE_DRIVE_API_KEY`と`GOOGLE_DRIVE_CLIENT_ID`](https://github.com/Startr/WEB-Sage.Education-docs/blob/main/docs/getting-started/env-configuration.md)環境変数の設定が必要です。

### 詳細な手順

1. OAuth 2.0クライアントを作成し、「承認済みのJavaScript生成元」と「承認済みのリダイレクトURI」の両方をsage-open-webuiインスタンスにアクセスするURL（ポートがある場合は含める）に設定します。
1. そのOAuthクライアントに関連付けられたクライアントIDをメモします。
1. プロジェクトに対してGoogle Drive APIとGoogle Picker APIの両方を有効化していることを確認します。
1. アプリ（プロジェクト）を「テスト中」に設定し、Google Driveのメールアドレスを「ユーザーリスト」に追加します。
1. 権限スコープにそれらのAPIが提供するすべての機能を含めるように設定します。アプリが「テスト中」モードであるため、限定されたテストユーザーのデータにアクセスするためにGoogleによる検証は不要です。
1. Google Picker APIのページに移動し、「認証情報を作成」ボタンをクリックします。
1. APIキーを作成し、「アプリケーションの制限」で「ウェブサイト」を選択します。ステップ1で設定した「承認済みのJavaScript生成元」と「承認済みのリダイレクトURI」と同じURLをsage-open-webuiインスタンスのURLとして追加します。
1. APIキーに設定するAPI制限で、Google Drive APIとGoogle Picker APIのみにアクセスを制限します。
1. 環境変数`GOOGLE_DRIVE_CLIENT_ID`をステップ2のOAuthクライアントのクライアントIDに設定します。
1. 環境変数`GOOGLE_DRIVE_API_KEY`をステップ7で設定したAPIキーの値に設定します（ステップ2のOAuthクライアントシークレットではありません）。
1. `GOOGLE_REDIRECT_URI`をsage-open-webuiインスタンスのURL（ポートがある場合は含める）に設定します。
1. その後、これら3つの環境変数を設定してsage-open-webuiインスタンスを再起動します。
1. 最後に、`管理パネル` < `設定` < `ドキュメント` < `Google Drive`でGoogle Driveが有効化されていることを確認します。